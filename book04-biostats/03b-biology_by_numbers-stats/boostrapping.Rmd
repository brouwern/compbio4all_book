# Bootstrapping Tutrial: Fst from Evans et al 2016



# Fst data

## Load Fst into vector
```{r}
Fstperloc <- c(0.8589462,0.4133128,0.6851604,0.7366967,0.7925415,0.7161766,0.4683899,0.8355689)

```

## Mean Fst

```{r}
Fst.mean <- mean(Fstperloc)

Fst.mean
```

## Distribution of Fst values

* 2 Fst values lower than the rest
* Non-normality is a good reason to use boostrapping

### Histogram base R


```{r}
#histogram of Fst
hist(Fstperloc)

#vertical line for mean
abline(v =Fst.mean, col = 2, lwd = 2 )
```

### Boxplot base R

```{r}
#boxplot
boxplot(Fstperloc,
        ylim = c(0,1))
```


### Boxplot ggplot


Just the boxplot
```{r}
library(ggplot2)

qplot(y = Fstperloc,
      x = 1, 
      geom = "boxplot")
```


Boxplot w/ raw data overlayed

* Set 2 "geoms" via "geom = c("boxplot", "point")
               

```{r}
library(ggplot2)

qplot(y = Fstperloc,
      x = 1, 
      geom = c("boxplot",
               "point"))
```


# Boostrapping Fst

Boostrapping with boot requires

* Defining a function for the desired summary statistic that is used by the boot() function
    + Want the mean and its confidence intervals
    + A tricky part about boot() is that you have to write a full R function
    + This requires a fair bit code for somethings as simple as the mean
* Extracting the desired confidence interval with boot.ci()

Load the package
```{r}
#load package
library(boot)
```

## Define function for the mean

* Function synatax takes a particualr form in R
* Here is the R code define a bran new function mean.fun()  function that will take 2 arguements
    + dat: our raw data
    + idx: an index of resampled data
* The original data has 8 Fst values
* What boot() does is generate 8 random index (idx) values from from the set c(1,2,3,4,5,6,7,8)
    + Sampling is with replacement
* "dat[idx]" calls up those index values
    + Note, there can be duplicate index values b/c of does sampling w/replacement
* The mean.fun() takes the mean of the data matching those index values
* This is repeatd many many times to build a sampling distribution


### The function mean.fun()
```{r}
mean.fun <- function(dat, idx) {mean(dat[idx], na.rm=TRUE)}
```

We can test the function

```{r}
# normal R mean function
mean(Fstperloc)

#mean.fun()
mean.fun(Fstperloc, idx = c(1:8))


#An arbitay set of idx values
mean.fun(Fstperloc, idx = c(1,1,2,4,5,2,8,7))
```


R has function for generating random numbers.  We can generate numbers from a uniform distribution from 1 to 8 like this using runif() for "random uniform"
```{r}
runif(n = 8,min = 1, max = 8)
```


We can make these whole numbers by rounding them
```{r}
round(runif(n = 8,min = 1, max = 8),0)
```



## Running boot

boot() takes 3 arguments

* The vector of raw data, Fstperloc
* mean.fun, the function for the summary statistica
* The number of replicates R

### Run the function

Run boot()
```{r}
bootfst = boot(Fstperloc, mean.fun, R=1000)

```

The raw output of boot() isn't very intersting; it just gives you the original mean
```{r}
bootfst

```

boot.ci() extracts the confidence interval
```{r}
boot.ci(bootfst, type=c("norm"))

```

There are numerous types of boostrap confidence itnrvals: "norm","basic", "stud", "perc", "bca".  You can get multiples like this

```{r}
boot.ci(bootfst, type=c("norm",
                        "basic",
                        "perc",
                        "bca"))
```


# Compare Fst to Qst

Make a draframe with Fst info and Qst

* All values reported in text

```{r}
Fst.vs.Qst <- data.frame(Statistic = c("Fst","Qst"),
                   Mean    = c(0.6883491, 1.0),
                   ci.lo   = c(0.556,     0.175),
                   ci.hi   = c(0.772,     1.0))
```


## Plot with ggplot

I do a little trick here to plot the raw data next to Fst

### Generate Jittered locations 

* I use rnorm to generate random x axis values centered on 1.12. 
* Mean Fst and its CI will get plotted at the 1.0 location on the x axis, though it will be labeled w/"Fst", not 1.0
* This generates jittered points
```{r}
Fstperloc.2 <- data.frame(Fstperloc = Fstperloc,
                          y = rnorm(length(Fstperloc), 1.12,0.015))
               
```

#### Plot data w/ jittered point

```{r}
library(ggplot2)
qplot(y = Mean,
      x = Statistic,
      data = Fst.vs.Qst) +
  geom_errorbar(aes(ymin = ci.lo, ymax = ci.hi),
                width = 0.05) +
  geom_point(aes(color = Statistic, 
                 shape = Statistic),
             size = 5) +
  theme_bw() +
  ylim(0,1.05) +
  xlab("")
```


#### Plot data w/jittered points
```{r}
library(ggplot2)
qplot(y = Mean,
      x = Statistic,
      data = Fst.vs.Qst) +
  geom_errorbar(aes(ymin = ci.lo, ymax = ci.hi),
                width = 0.05) +
  geom_point(aes(color = Statistic, 
                 shape = Statistic),
             size = 5) +
  theme_bw() +
  geom_point(data = Fstperloc.2,
             aes(y = Fstperloc, x = y)) +
  ylim(0,1.05) +
  xlab("")
```



library(ggplot2)

           
                          



# From the original text:

Under the heading: "GENETIC BASIS OF SINIGRIN VARIATION"
The main conclusions
"Genetic variation in sinigrin was partitioned primarily among, rather than within, populations, with c. 9% of total phenotypic variation attributable to population (Table S4) and 0% attributable to grandmaternalor selfed family. The resulting extreme estimate of QST (1,0.175-1, 95% CI) is not unexpected in a largely selfing species which likely establishes new populations from a small number of colonizing genotypes [citation?]. Populations were also highly diverged in neutral markers, with an overall FST of 0.688 (0.556-0.772, 95% CI)." 

Continuing
"Nonetheless, each population contained multiple multilocus genotypes (MLGT) (ranging from 0.63 to 2.83 multilocus genotype in offspring per field maternal family across populations), so the low within-population quantitative genetic variation
is not solely due to sampling a single selfed lineage.
This finding is at odds with our previous work suggesting a rapid evolution of sinigrin concentrations, which should require high levels of intrapopulation genetic variation on which to act (Lankau et al. 2009). However, the levels of intrapopulation genetic variation are likely to vary across the introduced range.""
